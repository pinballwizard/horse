{% extends "flatlease/template.html" %}
{% load staticfiles %}
{% block meta %}
{% endblock meta %}
{% block menu_name %}
    Поиск
{% endblock menu_name %}
{% block body %}
    <div class="container">
        <div class="row">
            <form action="{% url 'search' %}" role="form" method="get">
                {{ form.non_field_errors }}
                {% for field in form %}
                    {% if forloop.first %}
                        <div class="col l4 m4 s10">
                            {{ field }}
                            {{ fields.errors }}
                        </div>
                        <div class="col l1 m1 s2">
                            <button class="btn-floating waves-effect waves-light black-text tooltipped search-btn" data-tooltip="Искать" type="submit">
                                <i class="material-icons">search</i>
                            </button>
                        </div>
                    {% else %}
                        <div class="col l2 m2 s12">
                            <p>
                                {{ field }}
                                {{ field.label_tag }}
                                {{ field.errors }}
                            </p>
                        </div>
                    {% endif %}
                {% endfor %}
            </form>
        </div>
        <div class="row">
            {% for client in clients %}
                <div class="card col s12 m6 l4">
                    <a class="tooltipped right teal-text text-lighten-2 top-icon" data-position="bottom" data-delay="50" data-tooltip="Редактировать профиль" href="{% url 'update' client.id %}">
                        <i class="material-icons small" id="edit_{{ client.id }}">mode_edit</i>
                    </a>

                    <!-- Задолженности и потенциальность-->
                    {% if client.is_potential %}
                        <a class="tooltipped potential green-text text-darken-1 left top-icon" data-position="bottom" data-delay="50" data-tooltip="Потенциальный клиент">
                            <i class="material-icons small">help_outline</i>
                        </a>
                    {% endif %}
                    {% if client.debt %}
                        <a class="tooltipped warning yellow-text text-darken-3 left top-icon" data-position="bottom" data-delay="50" data-tooltip="Задолженность за 1 месяц">
                            <i class="material-icons small">warning</i>
                        </a>
                    {% endif %}
                    {% if client.debt %}
                        <a class="tooltipped debtor red-text text-darken-1 left top-icon" data-position="bottom" data-delay="50" data-tooltip="Задолженность за 2 или более месяцев">
                            <i class="material-icons small">error</i>
                        </a>
                    {% endif %}
                    <div class="card-content">
                        <h3 class="card-title center">{{ client.last_name }}<br>{{ client.name }} {{ client.second_name }}</h3>
                        <p>
                            Дата регистрации: {{ client.pub_date }} <br>
                            День рождения: {{ client.birthday }} <br>
                            Адрес: {{ client.residence }} <br>
                            Телефон: {{ client.phone }} <br>
                            Депозит: {{ client.balance }}
                        </p>
                    </div>
                    <div class="card-action">
                        <a class="btn white-text" href="{% url 'client_page' client.id %}">Открыть</a>
                        <a class="tooltipped green-text right" data-position="bottom" data-delay="50" data-tooltip="Добавить платеж" href="{% url 'client_page' client.id %}#payments">
                            <i class="material-icons small" id="payment_{{ client.id }}">local_atm</i>
                        </a>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <!-- Кнопка вызова модального окна добавления нового клиента -->
    <a class="btn-floating btn-large waves-effect waves-light red add-client tooltipped modal-trigger"
       data-position="top" data-delay="50" data-tooltip="Создать профиль клиента" href="#client-modal">
        <i class="material-icons">person_add</i>
    </a>
    <!-- Модальное окно добавления нового клиента -->

{#    <div id="client-modal" class="modal modal-fixed-footer">#}
{#        <form action="{% url 'update' client.id %}" role="form" method="post">#}
{#            <div class="modal-content">#}
{#                <h5>Создание клиентского профиля</h5>#}
{#                {% csrf_token %}#}
{#                {{ spouse_form.non_field_errors }}#}
{#                {% for field in spouse_form %}#}
{#                    <div class="fieldWrapper input-field">#}
{#                        {{ field }}#}
{#                        {{ field.label_tag }}#}
{#                        {{ field.errors }}#}
{#                    </div>#}
{#                {% endfor %}#}
{#            </div>#}
{#            <div class="modal-footer">#}
{#                <button class="btn waves-effect waves-light" type="submit">Сохранить</button>#}
{#            </div>#}
{#        </form>#}
{#    </div>#}
{% endblock body %}